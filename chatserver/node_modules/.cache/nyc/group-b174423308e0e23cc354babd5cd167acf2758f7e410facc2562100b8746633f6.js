function cov_12kiuzts3h(){var path="D:\\repository\\mychat\\chatserver\\dao\\group.js";var hash="173b17371975911ee07171e3e7a400234d381208";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\repository\\mychat\\chatserver\\dao\\group.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:39}},"1":{start:{line:2,column:13},end:{line:2,column:37}},"2":{start:{line:3,column:16},end:{line:3,column:43}},"3":{start:{line:4,column:15},end:{line:4,column:35}},"4":{start:{line:5,column:13},end:{line:5,column:47}},"5":{start:{line:7,column:0},end:{line:7,column:28}},"6":{start:{line:17,column:4},end:{line:17,column:50}},"7":{start:{line:17,column:14},end:{line:17,column:50}},"8":{start:{line:18,column:15},end:{line:18,column:49}},"9":{start:{line:19,column:4},end:{line:19,column:50}},"10":{start:{line:19,column:14},end:{line:19,column:50}},"11":{start:{line:20,column:16},end:{line:20,column:43}},"12":{start:{line:21,column:4},end:{line:21,column:50}},"13":{start:{line:21,column:14},end:{line:21,column:50}},"14":{start:{line:22,column:19},end:{line:22,column:23}},"15":{start:{line:23,column:21},end:{line:23,column:25}},"16":{start:{line:24,column:4},end:{line:40,column:5}},"17":{start:{line:25,column:8},end:{line:31,column:10}},"18":{start:{line:32,column:8},end:{line:37,column:10}},"19":{start:{line:39,column:8},end:{line:39,column:18}},"20":{start:{line:41,column:4},end:{line:55,column:5}},"21":{start:{line:65,column:15},end:{line:65,column:48}},"22":{start:{line:66,column:16},end:{line:66,column:51}},"23":{start:{line:68,column:4},end:{line:68,column:57}},"24":{start:{line:68,column:15},end:{line:68,column:57}},"25":{start:{line:69,column:4},end:{line:69,column:81}},"26":{start:{line:69,column:45},end:{line:69,column:81}},"27":{start:{line:70,column:4},end:{line:70,column:29}},"28":{start:{line:71,column:4},end:{line:71,column:23}},"29":{start:{line:72,column:21},end:{line:77,column:6}},"30":{start:{line:78,column:4},end:{line:89,column:5}},"31":{start:{line:100,column:4},end:{line:104,column:5}},"32":{start:{line:101,column:8},end:{line:101,column:69}},"33":{start:{line:103,column:8},end:{line:103,column:60}},"34":{start:{line:103,column:18},end:{line:103,column:60}},"35":{start:{line:105,column:4},end:{line:105,column:60}},"36":{start:{line:105,column:23},end:{line:105,column:60}},"37":{start:{line:106,column:4},end:{line:108,column:5}},"38":{start:{line:116,column:18},end:{line:116,column:56}},"39":{start:{line:117,column:4},end:{line:118,column:18}},"40":{start:{line:117,column:14},end:{line:117,column:26}},"41":{start:{line:118,column:9},end:{line:118,column:18}},"42":{start:{line:127,column:16},end:{line:127,column:40}},"43":{start:{line:128,column:17},end:{line:128,column:71}},"44":{start:{line:129,column:4},end:{line:131,column:6}},"45":{start:{line:130,column:8},end:{line:130,column:37}},"46":{start:{line:132,column:4},end:{line:132,column:18}},"47":{start:{line:141,column:18},end:{line:141,column:53}},"48":{start:{line:142,column:4},end:{line:142,column:27}},"49":{start:{line:142,column:15},end:{line:142,column:27}},"50":{start:{line:143,column:21},end:{line:145,column:6}},"51":{start:{line:144,column:8},end:{line:144,column:38}},"52":{start:{line:146,column:20},end:{line:146,column:47}},"53":{start:{line:147,column:18},end:{line:147,column:59}},"54":{start:{line:147,column:38},end:{line:147,column:58}},"55":{start:{line:148,column:4},end:{line:148,column:16}},"56":{start:{line:157,column:16},end:{line:157,column:25}},"57":{start:{line:158,column:4},end:{line:158,column:80}},"58":{start:{line:159,column:4},end:{line:165,column:5}},"59":{start:{line:174,column:16},end:{line:174,column:25}},"60":{start:{line:175,column:4},end:{line:175,column:77}},"61":{start:{line:176,column:4},end:{line:181,column:5}},"62":{start:{line:184,column:0},end:{line:191,column:1}}},fnMap:{"0":{name:"createGroup",decl:{start:{line:16,column:15},end:{line:16,column:26}},loc:{start:{line:16,column:57},end:{line:56,column:1}},line:16},"1":{name:"joinGroup",decl:{start:{line:64,column:15},end:{line:64,column:24}},loc:{start:{line:64,column:44},end:{line:91,column:1}},line:64},"2":{name:"delGroup",decl:{start:{line:98,column:15},end:{line:98,column:23}},loc:{start:{line:98,column:30},end:{line:109,column:1}},line:98},"3":{name:"getDefaultGroup",decl:{start:{line:115,column:15},end:{line:115,column:30}},loc:{start:{line:115,column:33},end:{line:119,column:1}},line:115},"4":{name:"searchGroup",decl:{start:{line:126,column:15},end:{line:126,column:26}},loc:{start:{line:126,column:33},end:{line:133,column:1}},line:126},"5":{name:"(anonymous_5)",decl:{start:{line:129,column:24},end:{line:129,column:25}},loc:{start:{line:129,column:33},end:{line:131,column:5}},line:129},"6":{name:"getGroupMembers",decl:{start:{line:140,column:15},end:{line:140,column:30}},loc:{start:{line:140,column:37},end:{line:149,column:1}},line:140},"7":{name:"(anonymous_7)",decl:{start:{line:143,column:39},end:{line:143,column:40}},loc:{start:{line:143,column:45},end:{line:145,column:5}},line:143},"8":{name:"(anonymous_8)",decl:{start:{line:147,column:30},end:{line:147,column:31}},loc:{start:{line:147,column:38},end:{line:147,column:58}},line:147},"9":{name:"convertGroupMsg",decl:{start:{line:156,column:9},end:{line:156,column:24}},loc:{start:{line:156,column:32},end:{line:166,column:1}},line:156},"10":{name:"convertUserMsg",decl:{start:{line:173,column:9},end:{line:173,column:23}},loc:{start:{line:173,column:30},end:{line:182,column:1}},line:173}},branchMap:{"0":{loc:{start:{line:17,column:4},end:{line:17,column:50}},type:"if",locations:[{start:{line:17,column:4},end:{line:17,column:50}},{start:{line:17,column:4},end:{line:17,column:50}}],line:17},"1":{loc:{start:{line:19,column:4},end:{line:19,column:50}},type:"if",locations:[{start:{line:19,column:4},end:{line:19,column:50}},{start:{line:19,column:4},end:{line:19,column:50}}],line:19},"2":{loc:{start:{line:21,column:4},end:{line:21,column:50}},type:"if",locations:[{start:{line:21,column:4},end:{line:21,column:50}},{start:{line:21,column:4},end:{line:21,column:50}}],line:21},"3":{loc:{start:{line:68,column:4},end:{line:68,column:57}},type:"if",locations:[{start:{line:68,column:4},end:{line:68,column:57}},{start:{line:68,column:4},end:{line:68,column:57}}],line:68},"4":{loc:{start:{line:69,column:4},end:{line:69,column:81}},type:"if",locations:[{start:{line:69,column:4},end:{line:69,column:81}},{start:{line:69,column:4},end:{line:69,column:81}}],line:69},"5":{loc:{start:{line:103,column:8},end:{line:103,column:60}},type:"if",locations:[{start:{line:103,column:8},end:{line:103,column:60}},{start:{line:103,column:8},end:{line:103,column:60}}],line:103},"6":{loc:{start:{line:105,column:4},end:{line:105,column:60}},type:"if",locations:[{start:{line:105,column:4},end:{line:105,column:60}},{start:{line:105,column:4},end:{line:105,column:60}}],line:105},"7":{loc:{start:{line:117,column:4},end:{line:118,column:18}},type:"if",locations:[{start:{line:117,column:4},end:{line:118,column:18}},{start:{line:117,column:4},end:{line:118,column:18}}],line:117},"8":{loc:{start:{line:142,column:4},end:{line:142,column:27}},type:"if",locations:[{start:{line:142,column:4},end:{line:142,column:27}},{start:{line:142,column:4},end:{line:142,column:27}}],line:142},"9":{loc:{start:{line:158,column:4},end:{line:158,column:80}},type:"binary-expr",locations:[{start:{line:158,column:4},end:{line:158,column:27}},{start:{line:158,column:32},end:{line:158,column:79}}],line:158},"10":{loc:{start:{line:175,column:4},end:{line:175,column:77}},type:"binary-expr",locations:[{start:{line:175,column:4},end:{line:175,column:26}},{start:{line:175,column:31},end:{line:175,column:76}}],line:175}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"173b17371975911ee07171e3e7a400234d381208"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_12kiuzts3h=function(){return actualCoverage;};return actualCoverage;}cov_12kiuzts3h();const Group=(cov_12kiuzts3h().s[0]++,require('../model/group'));const User=(cov_12kiuzts3h().s[1]++,require('../model/user'));const Message=(cov_12kiuzts3h().s[2]++,require('../model/message'));const config=(cov_12kiuzts3h().s[3]++,require('../config'));const util=(cov_12kiuzts3h().s[4]++,require("../util/getRandomAvatar"));cov_12kiuzts3h().s[5]++;require("../util/database");/**
 * 创建群组
 * @param name
 * @param desc
 * @param username
 * @returns {Promise<{msg: string, code: number, data: {creator: (*|creator|{ref, type}), name: *, avatar: (string|*|number|StringConstructor|String|avatar), desc: (*|desc|{default, match, type}|number|SVGDescElement)}}|{msg: string}|{msg: string}|{msg: string}>}
 */async function createGroup({name,creator,createTime}){cov_12kiuzts3h().f[0]++;cov_12kiuzts3h().s[6]++;if(!name){cov_12kiuzts3h().b[0][0]++;cov_12kiuzts3h().s[7]++;return{msg:'组名不能为空',status:400};}else{cov_12kiuzts3h().b[0][1]++;}let user=(cov_12kiuzts3h().s[8]++,await User.findOne({_id:creator}));cov_12kiuzts3h().s[9]++;if(!user){cov_12kiuzts3h().b[1][0]++;cov_12kiuzts3h().s[10]++;return{msg:'此用户不存在',status:400};}else{cov_12kiuzts3h().b[1][1]++;}let group=(cov_12kiuzts3h().s[11]++,await Group.findOne({name}));cov_12kiuzts3h().s[12]++;if(group){cov_12kiuzts3h().b[2][0]++;cov_12kiuzts3h().s[13]++;return{msg:'该群组已存在',status:400};}else{cov_12kiuzts3h().b[2][1]++;}let newGroup=(cov_12kiuzts3h().s[14]++,null);let newMessage=(cov_12kiuzts3h().s[15]++,null);cov_12kiuzts3h().s[16]++;try{cov_12kiuzts3h().s[17]++;newGroup=await Group.create({name,creator,createTime,avatar:util.getRandomAvatar(),members:[creator]});cov_12kiuzts3h().s[18]++;newMessage=await Message.create({to:newGroup._id,style:'system',content:user.username+'加入群聊',createTime:new Date()});}catch(err){cov_12kiuzts3h().s[19]++;throw err;}cov_12kiuzts3h().s[20]++;return{_id:newGroup._id,name:newGroup.name,desc:newGroup.desc,avatar:util.getAvatarData(newGroup.avatar),creator:newGroup.creator,createTime:newGroup.createTime,message:{_id:newMessage._id,style:newMessage.style,content:newMessage.content,createTime:newMessage.createTime,to:newMessage.to}};}/**
 * 加入群组
 * @param userId
 * @param groupId
 * @returns {Promise<{msg: string}|{msg: string, data: {}}|{msg: string}>}
 */async function joinGroup({userId,groupId}){cov_12kiuzts3h().f[1]++;let user=(cov_12kiuzts3h().s[21]++,await User.findOne({_id:userId}));let group=(cov_12kiuzts3h().s[22]++,await Group.findOne({_id:groupId}));cov_12kiuzts3h().s[23]++;if(!group){cov_12kiuzts3h().b[3][0]++;cov_12kiuzts3h().s[24]++;return{msg:'加入群组失败，该群组不存在',status:400};}else{cov_12kiuzts3h().b[3][1]++;}cov_12kiuzts3h().s[25]++;if(group.members.indexOf(user._id)>-1){cov_12kiuzts3h().b[4][0]++;cov_12kiuzts3h().s[26]++;return{msg:'你已在群组中',status:400};}else{cov_12kiuzts3h().b[4][1]++;}cov_12kiuzts3h().s[27]++;group.members.push(user);cov_12kiuzts3h().s[28]++;await group.save();let newMessage=(cov_12kiuzts3h().s[29]++,await Message.create({to:group._id,style:'system',content:user.username+'加入群聊',createTime:new Date()}));cov_12kiuzts3h().s[30]++;return{...convertGroupMsg(group),createTime:group.createTime,type:1,message:{_id:newMessage._id,style:newMessage.style,content:newMessage.content,createTime:newMessage.createTime,to:newMessage.to}};}/**
 * 解散群组
 * @param data
 * @returns {Promise<{id: *}|{msg: string, status: number}|{msg: string, status: number}>}
 */async function delGroup(data){cov_12kiuzts3h().f[2]++;let result;cov_12kiuzts3h().s[31]++;try{cov_12kiuzts3h().s[32]++;result=await Group.deleteOne({_id:data,isDefault:false});}catch(error){cov_12kiuzts3h().s[33]++;if(error){cov_12kiuzts3h().b[5][0]++;cov_12kiuzts3h().s[34]++;return{status:400,msg:'该群组不存在或你没有此权限'};}else{cov_12kiuzts3h().b[5][1]++;}}cov_12kiuzts3h().s[35]++;if(result.n===0){cov_12kiuzts3h().b[6][0]++;cov_12kiuzts3h().s[36]++;return{status:400,msg:'默认群组不能解散'};}else{cov_12kiuzts3h().b[6][1]++;}cov_12kiuzts3h().s[37]++;return{id:data};}/**
 * 获取默认群组信息
 * @returns {Promise<{}|*>}
 */async function getDefaultGroup(){cov_12kiuzts3h().f[3]++;const group=(cov_12kiuzts3h().s[38]++,await Group.findOne({isDefault:true}));cov_12kiuzts3h().s[39]++;if(group){cov_12kiuzts3h().b[7][0]++;cov_12kiuzts3h().s[40]++;return group;}else{cov_12kiuzts3h().b[7][1]++;cov_12kiuzts3h().s[41]++;return{};}}/**
 * 搜索群组
 * @param data
 * @returns {Promise<*>}
 */async function searchGroup(data){cov_12kiuzts3h().f[4]++;const reg=(cov_12kiuzts3h().s[42]++,new RegExp(data.keyword));let groups=(cov_12kiuzts3h().s[43]++,await Group.find({name:{$regex:reg,$options:'i'}}));cov_12kiuzts3h().s[44]++;groups=groups.map(group=>{cov_12kiuzts3h().f[5]++;cov_12kiuzts3h().s[45]++;return convertGroupMsg(group);});cov_12kiuzts3h().s[46]++;return groups;}/**
 * 获取群组成员
 * @param data
 * @returns {Promise<{_id: *, tag: *, avatar, username: *}[]|boolean>}
 */async function getGroupMembers(data){cov_12kiuzts3h().f[6]++;const group=(cov_12kiuzts3h().s[47]++,await Group.findOne({name:data}));cov_12kiuzts3h().s[48]++;if(!group){cov_12kiuzts3h().b[8][0]++;cov_12kiuzts3h().s[49]++;return false;}else{cov_12kiuzts3h().b[8][1]++;}const promises=(cov_12kiuzts3h().s[50]++,group.members.map(id=>{cov_12kiuzts3h().f[7]++;cov_12kiuzts3h().s[51]++;return User.findOne({_id:id});}));const results=(cov_12kiuzts3h().s[52]++,await Promise.all(promises));const users=(cov_12kiuzts3h().s[53]++,results.map(user=>{cov_12kiuzts3h().f[8]++;cov_12kiuzts3h().s[54]++;return convertUserMsg(user);}));cov_12kiuzts3h().s[55]++;return users;}/**
 * 转换群组对象
 * @param group
 * @returns {{membersNum: number, creator: (*|creator|{ref, type}|number), name: *, _id: *, avatar}}
 */function convertGroupMsg(group){cov_12kiuzts3h().f[9]++;const reg=(cov_12kiuzts3h().s[56]++,/base64/g);cov_12kiuzts3h().s[57]++;(cov_12kiuzts3h().b[9][0]++,!reg.test(group.avatar))&&(cov_12kiuzts3h().b[9][1]++,group.avatar=util.getAvatarData(group.avatar));cov_12kiuzts3h().s[58]++;return{_id:group._id,name:group.name,avatar:group.avatar,membersNum:group.members.length,creator:group.creator};}/**
 * 转换用户对象
 * @param user
 * @returns {{_id: *, tag: *, avatar, username: *}}
 */function convertUserMsg(user){cov_12kiuzts3h().f[10]++;const reg=(cov_12kiuzts3h().s[59]++,/base64/g);cov_12kiuzts3h().s[60]++;(cov_12kiuzts3h().b[10][0]++,!reg.test(user.avatar))&&(cov_12kiuzts3h().b[10][1]++,user.avatar=util.getAvatarData(user.avatar));cov_12kiuzts3h().s[61]++;return{_id:user._id,tag:user.tag,username:user.username,avatar:user.avatar};}cov_12kiuzts3h().s[62]++;module.exports={createGroup,joinGroup,getDefaultGroup,searchGroup,getGroupMembers,delGroup};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdyb3VwLmpzIl0sIm5hbWVzIjpbIkdyb3VwIiwicmVxdWlyZSIsIlVzZXIiLCJNZXNzYWdlIiwiY29uZmlnIiwidXRpbCIsImNyZWF0ZUdyb3VwIiwibmFtZSIsImNyZWF0b3IiLCJjcmVhdGVUaW1lIiwibXNnIiwic3RhdHVzIiwidXNlciIsImZpbmRPbmUiLCJfaWQiLCJncm91cCIsIm5ld0dyb3VwIiwibmV3TWVzc2FnZSIsImNyZWF0ZSIsImF2YXRhciIsImdldFJhbmRvbUF2YXRhciIsIm1lbWJlcnMiLCJ0byIsInN0eWxlIiwiY29udGVudCIsInVzZXJuYW1lIiwiRGF0ZSIsImVyciIsImRlc2MiLCJnZXRBdmF0YXJEYXRhIiwibWVzc2FnZSIsImpvaW5Hcm91cCIsInVzZXJJZCIsImdyb3VwSWQiLCJpbmRleE9mIiwicHVzaCIsInNhdmUiLCJjb252ZXJ0R3JvdXBNc2ciLCJ0eXBlIiwiZGVsR3JvdXAiLCJkYXRhIiwicmVzdWx0IiwiZGVsZXRlT25lIiwiaXNEZWZhdWx0IiwiZXJyb3IiLCJuIiwiaWQiLCJnZXREZWZhdWx0R3JvdXAiLCJzZWFyY2hHcm91cCIsInJlZyIsIlJlZ0V4cCIsImtleXdvcmQiLCJncm91cHMiLCJmaW5kIiwiJHJlZ2V4IiwiJG9wdGlvbnMiLCJtYXAiLCJnZXRHcm91cE1lbWJlcnMiLCJwcm9taXNlcyIsInJlc3VsdHMiLCJQcm9taXNlIiwiYWxsIiwidXNlcnMiLCJjb252ZXJ0VXNlck1zZyIsInRlc3QiLCJtZW1iZXJzTnVtIiwibGVuZ3RoIiwidGFnIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IjBnUkFBQSxLQUFNQSxDQUFBQSxLQUFLLDBCQUFHQyxPQUFPLENBQUMsZ0JBQUQsQ0FBVixDQUFYLENBQ0EsS0FBTUMsQ0FBQUEsSUFBSSwwQkFBR0QsT0FBTyxDQUFDLGVBQUQsQ0FBVixDQUFWLENBQ0EsS0FBTUUsQ0FBQUEsT0FBTywwQkFBR0YsT0FBTyxDQUFDLGtCQUFELENBQVYsQ0FBYixDQUNB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UUFIWixDQUlITixNQUFNLENBQUdQLElBQUksQ0FBQ08sTUFKWCxDQUFQLENBTUgsQyx5QkFFRGlELE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUNiL0QsV0FEYSxDQUVieUIsU0FGYSxDQUdiZ0IsZUFIYSxDQUliQyxXQUphLENBS2JTLGVBTGEsQ0FNYmxCLFFBTmEsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBHcm91cCA9IHJlcXVpcmUoJy4uL21vZGVsL2dyb3VwJyk7XHJcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbC91c2VyJyk7XHJcbmNvbnN0IE1lc3NhZ2UgPSByZXF1aXJlKCcuLi9tb2RlbC9tZXNzYWdlJyk7XHJcbmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoJy4uL2NvbmZpZycpO1xyXG5jb25zdCB1dGlsID0gcmVxdWlyZShcIi4uL3V0aWwvZ2V0UmFuZG9tQXZhdGFyXCIpO1xyXG5cclxucmVxdWlyZShcIi4uL3V0aWwvZGF0YWJhc2VcIik7XHJcblxyXG4vKipcclxuICog5Yib5bu6576k57uEXHJcbiAqIEBwYXJhbSBuYW1lXHJcbiAqIEBwYXJhbSBkZXNjXHJcbiAqIEBwYXJhbSB1c2VybmFtZVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bXNnOiBzdHJpbmcsIGNvZGU6IG51bWJlciwgZGF0YToge2NyZWF0b3I6ICgqfGNyZWF0b3J8e3JlZiwgdHlwZX0pLCBuYW1lOiAqLCBhdmF0YXI6IChzdHJpbmd8KnxudW1iZXJ8U3RyaW5nQ29uc3RydWN0b3J8U3RyaW5nfGF2YXRhciksIGRlc2M6ICgqfGRlc2N8e2RlZmF1bHQsIG1hdGNoLCB0eXBlfXxudW1iZXJ8U1ZHRGVzY0VsZW1lbnQpfX18e21zZzogc3RyaW5nfXx7bXNnOiBzdHJpbmd9fHttc2c6IHN0cmluZ30+fVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlR3JvdXAoe25hbWUsIGNyZWF0b3IsIGNyZWF0ZVRpbWUgfSkge1xyXG4gICAgaWYoIW5hbWUpIHJldHVybiB7bXNnOiAn57uE5ZCN5LiN6IO95Li656m6Jywgc3RhdHVzOiA0MDB9O1xyXG4gICAgbGV0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoe19pZDogY3JlYXRvcn0pO1xyXG4gICAgaWYoIXVzZXIpIHJldHVybiB7bXNnOiAn5q2k55So5oi35LiN5a2Y5ZyoJywgc3RhdHVzOiA0MDB9O1xyXG4gICAgbGV0IGdyb3VwID0gYXdhaXQgR3JvdXAuZmluZE9uZSh7bmFtZX0pO1xyXG4gICAgaWYoZ3JvdXApIHJldHVybiB7bXNnOiAn6K+l576k57uE5bey5a2Y5ZyoJywgc3RhdHVzOiA0MDB9O1xyXG4gICAgbGV0IG5ld0dyb3VwID0gbnVsbDtcclxuICAgIGxldCBuZXdNZXNzYWdlID0gbnVsbDtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgbmV3R3JvdXA9IGF3YWl0IEdyb3VwLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgIGNyZWF0b3IsXHJcbiAgICAgICAgICAgIGNyZWF0ZVRpbWUsXHJcbiAgICAgICAgICAgIGF2YXRhcjogdXRpbC5nZXRSYW5kb21BdmF0YXIoKSxcclxuICAgICAgICAgICAgbWVtYmVyczogW2NyZWF0b3JdXHJcbiAgICAgICAgfSlcclxuICAgICAgICBuZXdNZXNzYWdlID0gYXdhaXQgTWVzc2FnZS5jcmVhdGUoe1xyXG4gICAgICAgICAgICB0bzogbmV3R3JvdXAuX2lkLFxyXG4gICAgICAgICAgICBzdHlsZTogJ3N5c3RlbScsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IHVzZXIudXNlcm5hbWUgKyAn5Yqg5YWl576k6IGKJyxcclxuICAgICAgICAgICAgY3JlYXRlVGltZTogbmV3IERhdGUoKVxyXG4gICAgICAgIH0pXHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgIHRocm93IGVycjtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgX2lkOiBuZXdHcm91cC5faWQsXHJcbiAgICAgICAgbmFtZTogbmV3R3JvdXAubmFtZSxcclxuICAgICAgICBkZXNjOiBuZXdHcm91cC5kZXNjLFxyXG4gICAgICAgIGF2YXRhcjogdXRpbC5nZXRBdmF0YXJEYXRhKG5ld0dyb3VwLmF2YXRhciksXHJcbiAgICAgICAgY3JlYXRvcjogbmV3R3JvdXAuY3JlYXRvcixcclxuICAgICAgICBjcmVhdGVUaW1lOiBuZXdHcm91cC5jcmVhdGVUaW1lLFxyXG4gICAgICAgIG1lc3NhZ2U6IHtcclxuICAgICAgICAgICAgX2lkOiBuZXdNZXNzYWdlLl9pZCxcclxuICAgICAgICAgICAgc3R5bGU6IG5ld01lc3NhZ2Uuc3R5bGUsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IG5ld01lc3NhZ2UuY29udGVudCxcclxuICAgICAgICAgICAgY3JlYXRlVGltZTogbmV3TWVzc2FnZS5jcmVhdGVUaW1lLFxyXG4gICAgICAgICAgICB0bzogbmV3TWVzc2FnZS50byxcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDliqDlhaXnvqTnu4RcclxuICogQHBhcmFtIHVzZXJJZFxyXG4gKiBAcGFyYW0gZ3JvdXBJZFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bXNnOiBzdHJpbmd9fHttc2c6IHN0cmluZywgZGF0YToge319fHttc2c6IHN0cmluZ30+fVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gam9pbkdyb3VwKHt1c2VySWQsIGdyb3VwSWR9KSB7XHJcbiAgICBsZXQgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7X2lkOiB1c2VySWR9KTtcclxuICAgIGxldCBncm91cCA9IGF3YWl0IEdyb3VwLmZpbmRPbmUoe19pZDogZ3JvdXBJZH0pO1xyXG5cclxuICAgIGlmKCFncm91cCkgcmV0dXJuIHttc2c6ICfliqDlhaXnvqTnu4TlpLHotKXvvIzor6XnvqTnu4TkuI3lrZjlnKgnLCBzdGF0dXM6IDQwMH1cclxuICAgIGlmKGdyb3VwLm1lbWJlcnMuaW5kZXhPZih1c2VyLl9pZCkgPiAtMSkgcmV0dXJuIHttc2c6ICfkvaDlt7LlnKjnvqTnu4TkuK0nLCBzdGF0dXM6IDQwMH07XHJcbiAgICBncm91cC5tZW1iZXJzLnB1c2godXNlcik7XHJcbiAgICBhd2FpdCBncm91cC5zYXZlKCk7XHJcbiAgICBsZXQgbmV3TWVzc2FnZSA9IGF3YWl0IE1lc3NhZ2UuY3JlYXRlKHtcclxuICAgICAgICB0bzogZ3JvdXAuX2lkLFxyXG4gICAgICAgIHN0eWxlOiAnc3lzdGVtJyxcclxuICAgICAgICBjb250ZW50OiB1c2VyLnVzZXJuYW1lICsgJ+WKoOWFpee+pOiBiicsXHJcbiAgICAgICAgY3JlYXRlVGltZTogbmV3IERhdGUoKVxyXG4gICAgfSlcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uY29udmVydEdyb3VwTXNnKGdyb3VwKSxcclxuICAgICAgICBjcmVhdGVUaW1lOiBncm91cC5jcmVhdGVUaW1lLFxyXG4gICAgICAgIHR5cGU6IDEsXHJcbiAgICAgICAgbWVzc2FnZToge1xyXG4gICAgICAgICAgICBfaWQ6IG5ld01lc3NhZ2UuX2lkLFxyXG4gICAgICAgICAgICBzdHlsZTogbmV3TWVzc2FnZS5zdHlsZSxcclxuICAgICAgICAgICAgY29udGVudDogbmV3TWVzc2FnZS5jb250ZW50LFxyXG4gICAgICAgICAgICBjcmVhdGVUaW1lOiBuZXdNZXNzYWdlLmNyZWF0ZVRpbWUsXHJcbiAgICAgICAgICAgIHRvOiBuZXdNZXNzYWdlLnRvLFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiDop6PmlaPnvqTnu4RcclxuICogQHBhcmFtIGRhdGFcclxuICogQHJldHVybnMge1Byb21pc2U8e2lkOiAqfXx7bXNnOiBzdHJpbmcsIHN0YXR1czogbnVtYmVyfXx7bXNnOiBzdHJpbmcsIHN0YXR1czogbnVtYmVyfT59XHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBkZWxHcm91cChkYXRhKSB7XHJcbiAgICBsZXQgcmVzdWx0O1xyXG4gICAgdHJ5IHtcclxuICAgICAgICByZXN1bHQgPSBhd2FpdCBHcm91cC5kZWxldGVPbmUoe19pZDogZGF0YSwgaXNEZWZhdWx0OiBmYWxzZX0pXHJcbiAgICB9IGNhdGNoKGVycm9yKSB7XHJcbiAgICAgICAgaWYoZXJyb3IpIHJldHVybiB7c3RhdHVzOiA0MDAsIG1zZzogJ+ivpee+pOe7hOS4jeWtmOWcqOaIluS9oOayoeacieatpOadg+mZkCd9XHJcbiAgICB9XHJcbiAgICBpZihyZXN1bHQubiA9PT0gMCkgcmV0dXJuIHtzdGF0dXM6IDQwMCwgbXNnOiAn6buY6K6k576k57uE5LiN6IO96Kej5pWjJ31cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaWQ6IGRhdGFcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOiOt+WPlum7mOiupOe+pOe7hOS/oeaBr1xyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7fXwqPn1cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdldERlZmF1bHRHcm91cCgpIHtcclxuICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgR3JvdXAuZmluZE9uZSh7aXNEZWZhdWx0OiB0cnVlfSlcclxuICAgIGlmKGdyb3VwKSByZXR1cm4gZ3JvdXBcclxuICAgIGVsc2UgcmV0dXJuIHt9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDmkJzntKLnvqTnu4RcclxuICogQHBhcmFtIGRhdGFcclxuICogQHJldHVybnMge1Byb21pc2U8Kj59XHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hHcm91cChkYXRhKSB7XHJcbiAgICBjb25zdCByZWcgPSBuZXcgUmVnRXhwKGRhdGEua2V5d29yZClcclxuICAgIGxldCBncm91cHMgPSBhd2FpdCBHcm91cC5maW5kKHtuYW1lOiB7JHJlZ2V4OiByZWcsICRvcHRpb25zOiAnaSd9fSlcclxuICAgIGdyb3VwcyA9IGdyb3Vwcy5tYXAoZ3JvdXAgPT4ge1xyXG4gICAgICAgIHJldHVybiBjb252ZXJ0R3JvdXBNc2coZ3JvdXApXHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIGdyb3VwcztcclxufVxyXG5cclxuLyoqXHJcbiAqIOiOt+WPlue+pOe7hOaIkOWRmFxyXG4gKiBAcGFyYW0gZGF0YVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7X2lkOiAqLCB0YWc6ICosIGF2YXRhciwgdXNlcm5hbWU6ICp9W118Ym9vbGVhbj59XHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZXRHcm91cE1lbWJlcnMoZGF0YSkge1xyXG4gICAgY29uc3QgZ3JvdXAgPSBhd2FpdCBHcm91cC5maW5kT25lKHsgbmFtZTogZGF0YSB9KVxyXG4gICAgaWYoIWdyb3VwKSByZXR1cm4gZmFsc2VcclxuICAgIGNvbnN0IHByb21pc2VzID0gZ3JvdXAubWVtYmVycy5tYXAoaWQgPT4ge1xyXG4gICAgICAgIHJldHVybiBVc2VyLmZpbmRPbmUoe19pZDogaWR9KVxyXG4gICAgfSlcclxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcylcclxuICAgIGNvbnN0IHVzZXJzID0gcmVzdWx0cy5tYXAodXNlciA9PiBjb252ZXJ0VXNlck1zZyh1c2VyKSlcclxuICAgIHJldHVybiB1c2Vyc1xyXG59XHJcblxyXG4vKipcclxuICog6L2s5o2i576k57uE5a+56LGhXHJcbiAqIEBwYXJhbSBncm91cFxyXG4gKiBAcmV0dXJucyB7e21lbWJlcnNOdW06IG51bWJlciwgY3JlYXRvcjogKCp8Y3JlYXRvcnx7cmVmLCB0eXBlfXxudW1iZXIpLCBuYW1lOiAqLCBfaWQ6ICosIGF2YXRhcn19XHJcbiAqL1xyXG5mdW5jdGlvbiBjb252ZXJ0R3JvdXBNc2coZ3JvdXApIHtcclxuICAgIGNvbnN0IHJlZyA9IC9iYXNlNjQvZztcclxuICAgICFyZWcudGVzdChncm91cC5hdmF0YXIpICYmIChncm91cC5hdmF0YXIgPSB1dGlsLmdldEF2YXRhckRhdGEoZ3JvdXAuYXZhdGFyKSlcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgX2lkOiBncm91cC5faWQsXHJcbiAgICAgICAgbmFtZTogZ3JvdXAubmFtZSxcclxuICAgICAgICBhdmF0YXI6IGdyb3VwLmF2YXRhcixcclxuICAgICAgICBtZW1iZXJzTnVtOiBncm91cC5tZW1iZXJzLmxlbmd0aCxcclxuICAgICAgICBjcmVhdG9yOiBncm91cC5jcmVhdG9yXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDovazmjaLnlKjmiLflr7nosaFcclxuICogQHBhcmFtIHVzZXJcclxuICogQHJldHVybnMge3tfaWQ6ICosIHRhZzogKiwgYXZhdGFyLCB1c2VybmFtZTogKn19XHJcbiAqL1xyXG5mdW5jdGlvbiBjb252ZXJ0VXNlck1zZyh1c2VyKSB7XHJcbiAgICBjb25zdCByZWcgPSAvYmFzZTY0L2c7XHJcbiAgICAhcmVnLnRlc3QodXNlci5hdmF0YXIpICYmICh1c2VyLmF2YXRhciA9IHV0aWwuZ2V0QXZhdGFyRGF0YSh1c2VyLmF2YXRhcikpXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIF9pZDogdXNlci5faWQsXHJcbiAgICAgICAgdGFnOiB1c2VyLnRhZyxcclxuICAgICAgICB1c2VybmFtZTogdXNlci51c2VybmFtZSxcclxuICAgICAgICBhdmF0YXI6ICB1c2VyLmF2YXRhcixcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgICBjcmVhdGVHcm91cCxcclxuICAgIGpvaW5Hcm91cCxcclxuICAgIGdldERlZmF1bHRHcm91cCxcclxuICAgIHNlYXJjaEdyb3VwLFxyXG4gICAgZ2V0R3JvdXBNZW1iZXJzLFxyXG4gICAgZGVsR3JvdXBcclxufVxyXG4iXX0=
function cov_15mkpfeeri(){var path="D:\\repository\\mychat\\chatserver\\dao\\user.js";var hash="c4bfb8b7cac6afc1859d670da1b60bf588f0a3d5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\repository\\mychat\\chatserver\\dao\\user.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:34}},"1":{start:{line:2,column:12},end:{line:2,column:33}},"2":{start:{line:3,column:13},end:{line:3,column:37}},"3":{start:{line:4,column:14},end:{line:4,column:39}},"4":{start:{line:5,column:15},end:{line:5,column:41}},"5":{start:{line:6,column:16},end:{line:6,column:43}},"6":{start:{line:7,column:13},end:{line:7,column:47}},"7":{start:{line:8,column:15},end:{line:8,column:35}},"8":{start:{line:17,column:4},end:{line:21,column:25}},"9":{start:{line:32,column:17},end:{line:32,column:49}},"10":{start:{line:33,column:4},end:{line:33,column:52}},"11":{start:{line:33,column:13},end:{line:33,column:52}},"12":{start:{line:34,column:25},end:{line:34,column:64}},"13":{start:{line:35,column:4},end:{line:35,column:60}},"14":{start:{line:35,column:22},end:{line:35,column:60}},"15":{start:{line:37,column:17},end:{line:37,column:54}},"16":{start:{line:39,column:17},end:{line:39,column:48}},"17":{start:{line:40,column:18},end:{line:40,column:22}},"18":{start:{line:41,column:4},end:{line:50,column:5}},"19":{start:{line:42,column:8},end:{line:47,column:11}},"20":{start:{line:49,column:8},end:{line:49,column:18}},"21":{start:{line:51,column:4},end:{line:53,column:5}},"22":{start:{line:52,column:8},end:{line:52,column:38}},"23":{start:{line:54,column:4},end:{line:54,column:39}},"24":{start:{line:55,column:4},end:{line:55,column:30}},"25":{start:{line:56,column:18},end:{line:56,column:22}},"26":{start:{line:57,column:4},end:{line:66,column:5}},"27":{start:{line:58,column:8},end:{line:63,column:10}},"28":{start:{line:65,column:8},end:{line:65,column:24}},"29":{start:{line:67,column:4},end:{line:70,column:5}},"30":{start:{line:81,column:15},end:{line:81,column:47}},"31":{start:{line:82,column:4},end:{line:82,column:54}},"32":{start:{line:82,column:14},end:{line:82,column:54}},"33":{start:{line:83,column:26},end:{line:83,column:69}},"34":{start:{line:84,column:4},end:{line:84,column:64}},"35":{start:{line:84,column:23},end:{line:84,column:64}},"36":{start:{line:85,column:4},end:{line:85,column:36}},"37":{start:{line:86,column:4},end:{line:86,column:22}},"38":{start:{line:87,column:19},end:{line:93,column:6}},"39":{start:{line:94,column:4},end:{line:98,column:6}},"40":{start:{line:95,column:20},end:{line:95,column:29}},"41":{start:{line:96,column:8},end:{line:96,column:84}},"42":{start:{line:97,column:8},end:{line:97,column:20}},"43":{start:{line:99,column:16},end:{line:99,column:47}},"44":{start:{line:100,column:20},end:{line:110,column:6}},"45":{start:{line:111,column:4},end:{line:133,column:6}},"46":{start:{line:112,column:20},end:{line:112,column:29}},"47":{start:{line:113,column:8},end:{line:113,column:96}},"48":{start:{line:114,column:8},end:{line:114,column:102}},"49":{start:{line:115,column:8},end:{line:132,column:9}},"50":{start:{line:135,column:16},end:{line:135,column:50}},"51":{start:{line:136,column:4},end:{line:136,column:24}},"52":{start:{line:137,column:4},end:{line:149,column:5}},"53":{start:{line:158,column:18},end:{line:158,column:22}},"54":{start:{line:159,column:4},end:{line:163,column:5}},"55":{start:{line:160,column:8},end:{line:160,column:54}},"56":{start:{line:162,column:8},end:{line:162,column:46}},"57":{start:{line:164,column:4},end:{line:164,column:82}},"58":{start:{line:164,column:37},end:{line:164,column:82}},"59":{start:{line:165,column:15},end:{line:165,column:56}},"60":{start:{line:166,column:4},end:{line:166,column:51}},"61":{start:{line:166,column:14},end:{line:166,column:51}},"62":{start:{line:167,column:4},end:{line:167,column:36}},"63":{start:{line:168,column:4},end:{line:168,column:22}},"64":{start:{line:169,column:19},end:{line:175,column:6}},"65":{start:{line:176,column:4},end:{line:180,column:6}},"66":{start:{line:177,column:20},end:{line:177,column:29}},"67":{start:{line:178,column:8},end:{line:178,column:84}},"68":{start:{line:179,column:8},end:{line:179,column:20}},"69":{start:{line:181,column:16},end:{line:181,column:47}},"70":{start:{line:182,column:20},end:{line:187,column:6}},"71":{start:{line:188,column:4},end:{line:210,column:6}},"72":{start:{line:189,column:20},end:{line:189,column:29}},"73":{start:{line:190,column:8},end:{line:190,column:96}},"74":{start:{line:191,column:8},end:{line:191,column:102}},"75":{start:{line:192,column:8},end:{line:209,column:9}},"76":{start:{line:211,column:4},end:{line:221,column:5}},"77":{start:{line:231,column:16},end:{line:231,column:40}},"78":{start:{line:232,column:16},end:{line:232,column:73}},"79":{start:{line:233,column:4},end:{line:235,column:6}},"80":{start:{line:234,column:8},end:{line:234,column:35}},"81":{start:{line:236,column:4},end:{line:236,column:17}},"82":{start:{line:240,column:16},end:{line:240,column:25}},"83":{start:{line:241,column:4},end:{line:241,column:77}},"84":{start:{line:242,column:4},end:{line:247,column:5}},"85":{start:{line:250,column:0},end:{line:255,column:1}}},fnMap:{"0":{name:"generateToken",decl:{start:{line:16,column:9},end:{line:16,column:22}},loc:{start:{line:16,column:52},end:{line:22,column:1}},line:16},"1":{name:"register",decl:{start:{line:31,column:15},end:{line:31,column:23}},loc:{start:{line:31,column:46},end:{line:71,column:1}},line:31},"2":{name:"loginByNameAndPass",decl:{start:{line:80,column:15},end:{line:80,column:33}},loc:{start:{line:80,column:56},end:{line:150,column:1}},line:80},"3":{name:"(anonymous_3)",decl:{start:{line:94,column:28},end:{line:94,column:29}},loc:{start:{line:94,column:37},end:{line:98,column:5}},line:94},"4":{name:"(anonymous_4)",decl:{start:{line:111,column:30},end:{line:111,column:31}},loc:{start:{line:111,column:40},end:{line:133,column:5}},line:111},"5":{name:"loginByToken",decl:{start:{line:157,column:15},end:{line:157,column:27}},loc:{start:{line:157,column:35},end:{line:223,column:1}},line:157},"6":{name:"(anonymous_6)",decl:{start:{line:176,column:28},end:{line:176,column:29}},loc:{start:{line:176,column:37},end:{line:180,column:5}},line:176},"7":{name:"(anonymous_7)",decl:{start:{line:188,column:30},end:{line:188,column:31}},loc:{start:{line:188,column:40},end:{line:210,column:5}},line:188},"8":{name:"searchFriend",decl:{start:{line:230,column:15},end:{line:230,column:27}},loc:{start:{line:230,column:34},end:{line:237,column:1}},line:230},"9":{name:"(anonymous_9)",decl:{start:{line:233,column:22},end:{line:233,column:23}},loc:{start:{line:233,column:30},end:{line:235,column:5}},line:233},"10":{name:"convertUserMsg",decl:{start:{line:239,column:9},end:{line:239,column:23}},loc:{start:{line:239,column:30},end:{line:248,column:1}},line:239}},branchMap:{"0":{loc:{start:{line:16,column:31},end:{line:16,column:50}},type:"default-arg",locations:[{start:{line:16,column:45},end:{line:16,column:50}}],line:16},"1":{loc:{start:{line:33,column:4},end:{line:33,column:52}},type:"if",locations:[{start:{line:33,column:4},end:{line:33,column:52}},{start:{line:33,column:4},end:{line:33,column:52}}],line:33},"2":{loc:{start:{line:35,column:4},end:{line:35,column:60}},type:"if",locations:[{start:{line:35,column:4},end:{line:35,column:60}},{start:{line:35,column:4},end:{line:35,column:60}}],line:35},"3":{loc:{start:{line:51,column:4},end:{line:53,column:5}},type:"if",locations:[{start:{line:51,column:4},end:{line:53,column:5}},{start:{line:51,column:4},end:{line:53,column:5}}],line:51},"4":{loc:{start:{line:82,column:4},end:{line:82,column:54}},type:"if",locations:[{start:{line:82,column:4},end:{line:82,column:54}},{start:{line:82,column:4},end:{line:82,column:54}}],line:82},"5":{loc:{start:{line:84,column:4},end:{line:84,column:64}},type:"if",locations:[{start:{line:84,column:4},end:{line:84,column:64}},{start:{line:84,column:4},end:{line:84,column:64}}],line:84},"6":{loc:{start:{line:96,column:8},end:{line:96,column:84}},type:"binary-expr",locations:[{start:{line:96,column:8},end:{line:96,column:31}},{start:{line:96,column:36},end:{line:96,column:83}}],line:96},"7":{loc:{start:{line:113,column:8},end:{line:113,column:96}},type:"binary-expr",locations:[{start:{line:113,column:8},end:{line:113,column:35}},{start:{line:113,column:40},end:{line:113,column:95}}],line:113},"8":{loc:{start:{line:114,column:8},end:{line:114,column:102}},type:"binary-expr",locations:[{start:{line:114,column:8},end:{line:114,column:37}},{start:{line:114,column:42},end:{line:114,column:101}}],line:114},"9":{loc:{start:{line:164,column:4},end:{line:164,column:82}},type:"if",locations:[{start:{line:164,column:4},end:{line:164,column:82}},{start:{line:164,column:4},end:{line:164,column:82}}],line:164},"10":{loc:{start:{line:166,column:4},end:{line:166,column:51}},type:"if",locations:[{start:{line:166,column:4},end:{line:166,column:51}},{start:{line:166,column:4},end:{line:166,column:51}}],line:166},"11":{loc:{start:{line:178,column:8},end:{line:178,column:84}},type:"binary-expr",locations:[{start:{line:178,column:8},end:{line:178,column:31}},{start:{line:178,column:36},end:{line:178,column:83}}],line:178},"12":{loc:{start:{line:190,column:8},end:{line:190,column:96}},type:"binary-expr",locations:[{start:{line:190,column:8},end:{line:190,column:35}},{start:{line:190,column:40},end:{line:190,column:95}}],line:190},"13":{loc:{start:{line:191,column:8},end:{line:191,column:102}},type:"binary-expr",locations:[{start:{line:191,column:8},end:{line:191,column:37}},{start:{line:191,column:42},end:{line:191,column:101}}],line:191},"14":{loc:{start:{line:241,column:4},end:{line:241,column:77}},type:"binary-expr",locations:[{start:{line:241,column:4},end:{line:241,column:26}},{start:{line:241,column:31},end:{line:241,column:76}}],line:241}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"c4bfb8b7cac6afc1859d670da1b60bf588f0a3d5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_15mkpfeeri=function(){return actualCoverage;};return actualCoverage;}cov_15mkpfeeri();const bcrypt=(cov_15mkpfeeri().s[0]++,require("bcryptjs"));const jwt=(cov_15mkpfeeri().s[1]++,require("jwt-simple"));const User=(cov_15mkpfeeri().s[2]++,require("../model/user"));const Group=(cov_15mkpfeeri().s[3]++,require("../model/group"));const Friend=(cov_15mkpfeeri().s[4]++,require("../model/friend"));const Message=(cov_15mkpfeeri().s[5]++,require("../model/message"));const util=(cov_15mkpfeeri().s[6]++,require("../util/getRandomAvatar"));const config=(cov_15mkpfeeri().s[7]++,require('../config'));/**
 * 生成Token
 * @param userId
 * @param environment
 * @returns {string}
 */function generateToken(userId,environment=(cov_15mkpfeeri().b[0][0]++,'web')){cov_15mkpfeeri().f[0]++;cov_15mkpfeeri().s[8]++;return jwt.encode({user:userId,environment,expires:Date.now()+config.tokenExpiresTime},config.jwtSecret);}/**
 * 注册新用户
 * @param name
 * @param password
 * @param environment
 * @returns {Promise<{msg: string, code: number, data: *}|{msg: string}|{msg: string}>}
 */async function register({username,password}){cov_15mkpfeeri().f[1]++;const user=(cov_15mkpfeeri().s[9]++,await User.findOne({username}));cov_15mkpfeeri().s[10]++;if(user){cov_15mkpfeeri().b[1][0]++;cov_15mkpfeeri().s[11]++;return{msg:"此用户名已存在",status:400};}else{cov_15mkpfeeri().b[1][1]++;}const defaultGroup=(cov_15mkpfeeri().s[12]++,await Group.findOne({isDefault:true}));cov_15mkpfeeri().s[13]++;if(!defaultGroup){cov_15mkpfeeri().b[2][0]++;cov_15mkpfeeri().s[14]++;return{msg:"默认群组不存在",status:400};}else{cov_15mkpfeeri().b[2][1]++;}//加密盐
const salt=(cov_15mkpfeeri().s[15]++,bcrypt.genSaltSync(config.saltLength));//密码转成hash值
const hash=(cov_15mkpfeeri().s[16]++,bcrypt.hashSync(password,salt));let newUser=(cov_15mkpfeeri().s[17]++,null);cov_15mkpfeeri().s[18]++;try{cov_15mkpfeeri().s[19]++;newUser=await User.create({username,password:hash,salt,avatar:util.getRandomAvatar()});}catch(err){cov_15mkpfeeri().s[20]++;throw err;}cov_15mkpfeeri().s[21]++;if(!defaultGroup.creator){cov_15mkpfeeri().b[3][0]++;cov_15mkpfeeri().s[22]++;defaultGroup.creator=newUser;}else{cov_15mkpfeeri().b[3][1]++;}cov_15mkpfeeri().s[23]++;defaultGroup.members.push(newUser);cov_15mkpfeeri().s[24]++;await defaultGroup.save();let message=(cov_15mkpfeeri().s[25]++,null);cov_15mkpfeeri().s[26]++;try{cov_15mkpfeeri().s[27]++;message=await Message.create({to:defaultGroup._id,style:'system',content:newUser.username+'加入群聊',createTime:new Date()});}catch(err){cov_15mkpfeeri().s[28]++;console.log(err);}cov_15mkpfeeri().s[29]++;return{status:200,msg:'注册成功！'};}/**
 * 账号密码登录
 * @param name
 * @param password
 * @param environment
 * @returns {Promise<{msg: string, data: {name: *, groups: *, avatar: (string|*|number|StringConstructor|String|avatar), friends: *}, token: string}|{msg: string}>}
 */async function loginByNameAndPass({username,password}){cov_15mkpfeeri().f[2]++;let user=(cov_15mkpfeeri().s[30]++,await User.findOne({username}));cov_15mkpfeeri().s[31]++;if(!user){cov_15mkpfeeri().b[4][0]++;cov_15mkpfeeri().s[32]++;return{msg:'无效的用户名或密码',status:400};}else{cov_15mkpfeeri().b[4][1]++;}const isPassCorrect=(cov_15mkpfeeri().s[33]++,bcrypt.compareSync(password,user.password));cov_15mkpfeeri().s[34]++;if(!isPassCorrect){cov_15mkpfeeri().b[5][0]++;cov_15mkpfeeri().s[35]++;return{msg:'无效的用户名或密码',status:400};}else{cov_15mkpfeeri().b[5][1]++;}cov_15mkpfeeri().s[36]++;user.lastLoginTime=Date.now();cov_15mkpfeeri().s[37]++;await user.save();let groupArr=(cov_15mkpfeeri().s[38]++,await Group.find({members:user},{_id:1,name:1,avatar:1,creator:1,createTime:1}));cov_15mkpfeeri().s[39]++;groupArr=groupArr.map(group=>{cov_15mkpfeeri().f[3]++;const reg=(cov_15mkpfeeri().s[40]++,/base64/g);cov_15mkpfeeri().s[41]++;(cov_15mkpfeeri().b[6][0]++,!reg.test(group.avatar))&&(cov_15mkpfeeri().b[6][1]++,group.avatar=util.getAvatarData(group.avatar));cov_15mkpfeeri().s[42]++;return group;});const reg=(cov_15mkpfeeri().s[43]++,new RegExp(user._id.toString()));let friendArr=(cov_15mkpfeeri().s[44]++,await Friend.find({relationId:reg,status:1}).populate("to",{_id:1,avatar:1,username:1,tag:1}).populate("from",{_id:1,avatar:1,username:1,tag:1}));cov_15mkpfeeri().s[45]++;friendArr=friendArr.map(friend=>{cov_15mkpfeeri().f[4]++;const reg=(cov_15mkpfeeri().s[46]++,/base64/g);cov_15mkpfeeri().s[47]++;(cov_15mkpfeeri().b[7][0]++,!reg.test(friend.to.avatar))&&(cov_15mkpfeeri().b[7][1]++,friend.to.avatar=util.getAvatarData(friend.to.avatar));cov_15mkpfeeri().s[48]++;(cov_15mkpfeeri().b[8][0]++,!reg.test(friend.from.avatar))&&(cov_15mkpfeeri().b[8][1]++,friend.from.avatar=util.getAvatarData(friend.from.avatar));cov_15mkpfeeri().s[49]++;return{_id:friend._id,createTime:friend.createTime,status:friend.status,relationId:friend.relationId,from:friend.from._id,fromUser:{username:friend.from.username,avatar:friend.from.avatar,tag:friend.from.tag},to:{_id:friend.to._id,username:friend.to.username,avatar:friend.to.avatar,tag:friend.to.tag}};});let token=(cov_15mkpfeeri().s[50]++,generateToken(user._id.toString()));cov_15mkpfeeri().s[51]++;config.token=token;cov_15mkpfeeri().s[52]++;return{status:200,msg:'登陆成功',token,data:{_id:user._id,username:user.username,avatar:util.getAvatarData(user.avatar),groups:groupArr,friends:friendArr,isAdmin:user._id.toString()===config.administrator}};}/**
 * token登录
 * @param token
 * @returns {Promise<{msg: string, status: number}|{data: {name: *, groups: *, avatar: (string|number|*|string|StringConstructor|String), isAdmin: boolean, friends: *}, status: number, token: *}|{msg: string, status: number}|{msg: string, status: number}>}
 */async function loginByToken(token){cov_15mkpfeeri().f[5]++;let payload=(cov_15mkpfeeri().s[53]++,null);cov_15mkpfeeri().s[54]++;try{cov_15mkpfeeri().s[55]++;payload=jwt.decode(token,config.jwtSecret);}catch(err){cov_15mkpfeeri().s[56]++;return{msg:"非法token",status:401};}cov_15mkpfeeri().s[57]++;if(Date.now()>payload.expires){cov_15mkpfeeri().b[9][0]++;cov_15mkpfeeri().s[58]++;return{msg:"token失效了，请重新登陆",status:401};}else{cov_15mkpfeeri().b[9][1]++;}let user=(cov_15mkpfeeri().s[59]++,await User.findOne({_id:payload.user}));cov_15mkpfeeri().s[60]++;if(!user){cov_15mkpfeeri().b[10][0]++;cov_15mkpfeeri().s[61]++;return{msg:'此用户不存在',status:401};}else{cov_15mkpfeeri().b[10][1]++;}cov_15mkpfeeri().s[62]++;user.lastLoginTime=Date.now();cov_15mkpfeeri().s[63]++;await user.save();let groupArr=(cov_15mkpfeeri().s[64]++,await Group.find({members:user},{_id:1,name:1,avatar:1,creator:1,createTime:1}));cov_15mkpfeeri().s[65]++;groupArr=groupArr.map(group=>{cov_15mkpfeeri().f[6]++;const reg=(cov_15mkpfeeri().s[66]++,/base64/g);cov_15mkpfeeri().s[67]++;(cov_15mkpfeeri().b[11][0]++,!reg.test(group.avatar))&&(cov_15mkpfeeri().b[11][1]++,group.avatar=util.getAvatarData(group.avatar));cov_15mkpfeeri().s[68]++;return group;});const reg=(cov_15mkpfeeri().s[69]++,new RegExp(user._id.toString()));let friendArr=(cov_15mkpfeeri().s[70]++,await Friend.find({relationId:{$regex:reg},status:1}).populate('to from',{_id:1,avatar:1,username:1,tag:1}));cov_15mkpfeeri().s[71]++;friendArr=friendArr.map(friend=>{cov_15mkpfeeri().f[7]++;const reg=(cov_15mkpfeeri().s[72]++,/base64/g);cov_15mkpfeeri().s[73]++;(cov_15mkpfeeri().b[12][0]++,!reg.test(friend.to.avatar))&&(cov_15mkpfeeri().b[12][1]++,friend.to.avatar=util.getAvatarData(friend.to.avatar));cov_15mkpfeeri().s[74]++;(cov_15mkpfeeri().b[13][0]++,!reg.test(friend.from.avatar))&&(cov_15mkpfeeri().b[13][1]++,friend.from.avatar=util.getAvatarData(friend.from.avatar));cov_15mkpfeeri().s[75]++;return{_id:friend._id,createTime:friend.createTime,status:friend.status,relationId:friend.relationId,from:friend.from._id,fromUser:{username:friend.from.username,avatar:friend.from.avatar,tag:friend.from.tag},to:{_id:friend.to._id,username:friend.to.username,avatar:friend.to.avatar,tag:friend.to.tag}};});cov_15mkpfeeri().s[76]++;return{status:200,data:{_id:user._id,username:user.username,avatar:util.getAvatarData(user.avatar),groups:groupArr,friends:friendArr,isAdmin:user._id.toString()===config.administrator}};}/**
 * 根据用户名查找用户
 * @param data
 * @returns {Promise<*>}
 */async function searchFriend(data){cov_15mkpfeeri().f[8]++;const reg=(cov_15mkpfeeri().s[77]++,new RegExp(data.keyword));let users=(cov_15mkpfeeri().s[78]++,await User.find({username:{$regex:reg,$options:'i'}}));cov_15mkpfeeri().s[79]++;users=users.map(user=>{cov_15mkpfeeri().f[9]++;cov_15mkpfeeri().s[80]++;return convertUserMsg(user);});cov_15mkpfeeri().s[81]++;return users;}function convertUserMsg(user){cov_15mkpfeeri().f[10]++;const reg=(cov_15mkpfeeri().s[82]++,/base64/g);cov_15mkpfeeri().s[83]++;(cov_15mkpfeeri().b[14][0]++,!reg.test(user.avatar))&&(cov_15mkpfeeri().b[14][1]++,user.avatar=util.getAvatarData(user.avatar));cov_15mkpfeeri().s[84]++;return{_id:user._id,tag:user.tag,username:user.username,avatar:user.avatar};}cov_15mkpfeeri().s[85]++;module.exports={register,loginByNameAndPass,loginByToken,searchFriend};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiYmNyeXB0IiwicmVxdWlyZSIsImp3dCIsIlVzZXIiLCJHcm91cCIsIkZyaWVuZCIsIk1lc3NhZ2UiLCJ1dGlsIiwiY29uZmlnIiwiZ2VuZXJhdGVUb2tlbiIsInVzZXJJZCIsImVudmlyb25tZW50IiwiZW5jb2RlIiwidXNlciIsImV4cGlyZXMiLCJEYXRlIiwibm93IiwidG9rZW5FeHBpcmVzVGltZSIsImp3dFNlY3JldCIsInJlZ2lzdGVyIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImZpbmRPbmUiLCJtc2ciLCJzdGF0dXMiLCJkZWZhdWx0R3JvdXAiLCJpc0RlZmF1bHQiLCJzYWx0IiwiZ2VuU2FsdFN5bmMiLCJzYWx0TGVuZ3RoIiwiaGFzaCIsImhhc2hTeW5jIiwibmV3VXNlciIsImNyZWF0ZSIsImF2YXRhciIsImdldFJhbmRvbUF2YXRhciIsImVyciIsImNyZWF0b3IiLCJtZW1iZXJzIiwicHVzaCIsInNhdmUiLCJtZXNzYWdlIiwidG8iLCJfaWQiLCJzdHlsZSIsImNvbnRlbnQiLCJjcmVhdGVUaW1lIiwiY29uc29sZSIsImxvZyIsImxvZ2luQnlOYW1lQW5kUGFzcyIsImlzUGFzc0NvcnJlY3QiLCJjb21wYXJlU3luYyIsImxhc3RMb2dpblRpbWUiLCJncm91cEFyciIsImZpbmQiLCJuYW1lIiwibWFwIiwiZ3JvdXAiLCJyZWciLCJ0ZXN0IiwiZ2V0QXZhdGFyRGF0YSIsIlJlZ0V4cCIsInRvU3RyaW5nIiwiZnJpZW5kQXJyIiwicmVsYXRpb25JZCIsInBvcHVsYXRlIiwidGFnIiwiZnJpZW5kIiwiZnJvbSIsImZyb21Vc2VyIiwidG9rZW4iLCJkYXRhIiwiZ3JvdXBzIiwiZnJpZW5kcyIsImlzQWRtaW4iLCJhZG1pbmlzdHJhdG9yIiwibG9naW5CeVRva2VuIiwicGF5bG9hZCIsImRlY29kZSIsIiRyZWdleCIsInNlYXJjaEZyaWVuZCIsImtleXdvcmQiLCJ1c2VycyIsIiRvcHRpb25zIiwiY29udmVydFVz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QUFtQi9DLElBQUksQ0FBQ3FCLE1BQXhCLENBQXpDLEVBRjBCLHlCQUcxQixNQUFPLENBQ0hTLEdBQUcsQ0FBRTlCLElBQUksQ0FBQzhCLEdBRFAsQ0FFSHVCLEdBQUcsQ0FBRXJELElBQUksQ0FBQ3FELEdBRlAsQ0FHSDlDLFFBQVEsQ0FBRVAsSUFBSSxDQUFDTyxRQUhaLENBSUhjLE1BQU0sQ0FBR3JCLElBQUksQ0FBQ3FCLE1BSlgsQ0FBUCxDQU1ILEMseUJBRURtRCxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FDYm5FLFFBRGEsQ0FFYjhCLGtCQUZhLENBR2IyQixZQUhhLENBSWJJLFlBSmEsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBiY3J5cHQgPSByZXF1aXJlKFwiYmNyeXB0anNcIik7XHJcbmNvbnN0IGp3dCA9IHJlcXVpcmUoXCJqd3Qtc2ltcGxlXCIpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZShcIi4uL21vZGVsL3VzZXJcIik7XHJcbmNvbnN0IEdyb3VwID0gcmVxdWlyZShcIi4uL21vZGVsL2dyb3VwXCIpO1xyXG5jb25zdCBGcmllbmQgPSByZXF1aXJlKFwiLi4vbW9kZWwvZnJpZW5kXCIpO1xyXG5jb25zdCBNZXNzYWdlID0gcmVxdWlyZShcIi4uL21vZGVsL21lc3NhZ2VcIik7XHJcbmNvbnN0IHV0aWwgPSByZXF1aXJlKFwiLi4vdXRpbC9nZXRSYW5kb21BdmF0YXJcIik7XHJcbmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoJy4uL2NvbmZpZycpO1xyXG5cclxuLyoqXHJcbiAqIOeUn+aIkFRva2VuXHJcbiAqIEBwYXJhbSB1c2VySWRcclxuICogQHBhcmFtIGVudmlyb25tZW50XHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBnZW5lcmF0ZVRva2VuKHVzZXJJZCwgZW52aXJvbm1lbnQgPSAnd2ViJykge1xyXG4gICAgcmV0dXJuIGp3dC5lbmNvZGUoe1xyXG4gICAgICAgIHVzZXI6IHVzZXJJZCxcclxuICAgICAgICBlbnZpcm9ubWVudCxcclxuICAgICAgICBleHBpcmVzOiBEYXRlLm5vdygpICsgY29uZmlnLnRva2VuRXhwaXJlc1RpbWVcclxuICAgIH0sIGNvbmZpZy5qd3RTZWNyZXQpO1xyXG59XHJcblxyXG4vKipcclxuICog5rOo5YaM5paw55So5oi3XHJcbiAqIEBwYXJhbSBuYW1lXHJcbiAqIEBwYXJhbSBwYXNzd29yZFxyXG4gKiBAcGFyYW0gZW52aXJvbm1lbnRcclxuICogQHJldHVybnMge1Byb21pc2U8e21zZzogc3RyaW5nLCBjb2RlOiBudW1iZXIsIGRhdGE6ICp9fHttc2c6IHN0cmluZ318e21zZzogc3RyaW5nfT59XHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiByZWdpc3Rlcih7dXNlcm5hbWUsIHBhc3N3b3JkfSkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IHVzZXJuYW1lIH0pO1xyXG4gICAgaWYodXNlcikgcmV0dXJuIHsgbXNnOiBcIuatpOeUqOaIt+WQjeW3suWtmOWcqFwiLCBzdGF0dXM6IDQwMCB9O1xyXG4gICAgY29uc3QgZGVmYXVsdEdyb3VwID0gYXdhaXQgR3JvdXAuZmluZE9uZSh7IGlzRGVmYXVsdDogdHJ1ZX0pO1xyXG4gICAgaWYoIWRlZmF1bHRHcm91cCkgcmV0dXJuIHsgbXNnOiBcIum7mOiupOe+pOe7hOS4jeWtmOWcqFwiLCBzdGF0dXM6IDQwMCB9XHJcbiAgICAvL+WKoOWvhuebkFxyXG4gICAgY29uc3Qgc2FsdCA9IGJjcnlwdC5nZW5TYWx0U3luYyhjb25maWcuc2FsdExlbmd0aCk7XHJcbiAgICAvL+Wvhueggei9rOaIkGhhc2jlgLxcclxuICAgIGNvbnN0IGhhc2ggPSBiY3J5cHQuaGFzaFN5bmMocGFzc3dvcmQsIHNhbHQpO1xyXG4gICAgbGV0IG5ld1VzZXIgPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBuZXdVc2VyID0gYXdhaXQgVXNlci5jcmVhdGUoe1xyXG4gICAgICAgICAgICB1c2VybmFtZSxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2gsXHJcbiAgICAgICAgICAgIHNhbHQsXHJcbiAgICAgICAgICAgIGF2YXRhcjogdXRpbC5nZXRSYW5kb21BdmF0YXIoKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICB9XHJcbiAgICBpZighZGVmYXVsdEdyb3VwLmNyZWF0b3IpIHtcclxuICAgICAgICBkZWZhdWx0R3JvdXAuY3JlYXRvciA9IG5ld1VzZXJcclxuICAgIH1cclxuICAgIGRlZmF1bHRHcm91cC5tZW1iZXJzLnB1c2gobmV3VXNlcik7XHJcbiAgICBhd2FpdCBkZWZhdWx0R3JvdXAuc2F2ZSgpO1xyXG4gICAgbGV0IG1lc3NhZ2UgPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBtZXNzYWdlID0gYXdhaXQgTWVzc2FnZS5jcmVhdGUoe1xyXG4gICAgICAgICAgICB0bzogZGVmYXVsdEdyb3VwLl9pZCxcclxuICAgICAgICAgICAgc3R5bGU6ICdzeXN0ZW0nLFxyXG4gICAgICAgICAgICBjb250ZW50OiBuZXdVc2VyLnVzZXJuYW1lICsgJ+WKoOWFpee+pOiBiicsXHJcbiAgICAgICAgICAgIGNyZWF0ZVRpbWU6IG5ldyBEYXRlKClcclxuICAgICAgICB9KVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgICBtc2c6ICfms6jlhozmiJDlip/vvIEnXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDotKblj7flr4bnoIHnmbvlvZVcclxuICogQHBhcmFtIG5hbWVcclxuICogQHBhcmFtIHBhc3N3b3JkXHJcbiAqIEBwYXJhbSBlbnZpcm9ubWVudFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bXNnOiBzdHJpbmcsIGRhdGE6IHtuYW1lOiAqLCBncm91cHM6ICosIGF2YXRhcjogKHN0cmluZ3wqfG51bWJlcnxTdHJpbmdDb25zdHJ1Y3RvcnxTdHJpbmd8YXZhdGFyKSwgZnJpZW5kczogKn0sIHRva2VuOiBzdHJpbmd9fHttc2c6IHN0cmluZ30+fVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gbG9naW5CeU5hbWVBbmRQYXNzKHt1c2VybmFtZSwgcGFzc3dvcmR9KSB7XHJcbiAgICBsZXQgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IHVzZXJuYW1lIH0pO1xyXG4gICAgaWYoIXVzZXIpIHJldHVybiB7IG1zZzogJ+aXoOaViOeahOeUqOaIt+WQjeaIluWvhueggScsIHN0YXR1czogNDAwfTtcclxuICAgIGNvbnN0IGlzUGFzc0NvcnJlY3QgPSBiY3J5cHQuY29tcGFyZVN5bmMocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpO1xyXG4gICAgaWYoIWlzUGFzc0NvcnJlY3QpIHJldHVybiB7IG1zZzogJ+aXoOaViOeahOeUqOaIt+WQjeaIluWvhueggScsIHN0YXR1czogNDAwIH07XHJcbiAgICB1c2VyLmxhc3RMb2dpblRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgYXdhaXQgdXNlci5zYXZlKCk7XHJcbiAgICBsZXQgZ3JvdXBBcnIgPSBhd2FpdCBHcm91cC5maW5kKHsgbWVtYmVyczogdXNlciB9LCB7XHJcbiAgICAgICAgX2lkOiAxLFxyXG4gICAgICAgIG5hbWU6IDEsXHJcbiAgICAgICAgYXZhdGFyOiAxLFxyXG4gICAgICAgIGNyZWF0b3I6IDEsXHJcbiAgICAgICAgY3JlYXRlVGltZTogMVxyXG4gICAgfSk7XHJcbiAgICBncm91cEFyciA9IGdyb3VwQXJyLm1hcChncm91cCA9PiB7XHJcbiAgICAgICAgY29uc3QgcmVnID0gL2Jhc2U2NC9nO1xyXG4gICAgICAgICFyZWcudGVzdChncm91cC5hdmF0YXIpICYmIChncm91cC5hdmF0YXIgPSB1dGlsLmdldEF2YXRhckRhdGEoZ3JvdXAuYXZhdGFyKSlcclxuICAgICAgICByZXR1cm4gZ3JvdXBcclxuICAgIH0pXHJcbiAgICBjb25zdCByZWcgPSBuZXcgUmVnRXhwKHVzZXIuX2lkLnRvU3RyaW5nKCkpXHJcbiAgICBsZXQgZnJpZW5kQXJyID0gYXdhaXQgRnJpZW5kLmZpbmQoeyByZWxhdGlvbklkOiByZWcsIHN0YXR1czogMSB9KS5wb3B1bGF0ZShcInRvXCIsIHtcclxuICAgICAgICBfaWQ6IDEsXHJcbiAgICAgICAgYXZhdGFyOiAxLFxyXG4gICAgICAgIHVzZXJuYW1lOiAxLFxyXG4gICAgICAgIHRhZzogMVxyXG4gICAgfSkucG9wdWxhdGUoXCJmcm9tXCIsIHtcclxuICAgICAgICBfaWQ6IDEsXHJcbiAgICAgICAgYXZhdGFyOiAxLFxyXG4gICAgICAgIHVzZXJuYW1lOiAxLFxyXG4gICAgICAgIHRhZzogMVxyXG4gICAgfSlcclxuICAgIGZyaWVuZEFyciA9IGZyaWVuZEFyci5tYXAoZnJpZW5kID0+IHtcclxuICAgICAgICBjb25zdCByZWcgPSAvYmFzZTY0L2c7XHJcbiAgICAgICAgIXJlZy50ZXN0KGZyaWVuZC50by5hdmF0YXIpICYmIChmcmllbmQudG8uYXZhdGFyID0gdXRpbC5nZXRBdmF0YXJEYXRhKGZyaWVuZC50by5hdmF0YXIpKVxyXG4gICAgICAgICFyZWcudGVzdChmcmllbmQuZnJvbS5hdmF0YXIpICYmIChmcmllbmQuZnJvbS5hdmF0YXIgPSB1dGlsLmdldEF2YXRhckRhdGEoZnJpZW5kLmZyb20uYXZhdGFyKSlcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBfaWQ6IGZyaWVuZC5faWQsXHJcbiAgICAgICAgICAgIGNyZWF0ZVRpbWU6IGZyaWVuZC5jcmVhdGVUaW1lLFxyXG4gICAgICAgICAgICBzdGF0dXM6IGZyaWVuZC5zdGF0dXMsXHJcbiAgICAgICAgICAgIHJlbGF0aW9uSWQ6IGZyaWVuZC5yZWxhdGlvbklkLFxyXG4gICAgICAgICAgICBmcm9tOiBmcmllbmQuZnJvbS5faWQsXHJcbiAgICAgICAgICAgIGZyb21Vc2VyOiB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogZnJpZW5kLmZyb20udXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGZyaWVuZC5mcm9tLmF2YXRhcixcclxuICAgICAgICAgICAgICAgIHRhZzogZnJpZW5kLmZyb20udGFnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRvOiB7XHJcbiAgICAgICAgICAgICAgICBfaWQ6IGZyaWVuZC50by5faWQsXHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogZnJpZW5kLnRvLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgYXZhdGFyOiBmcmllbmQudG8uYXZhdGFyLFxyXG4gICAgICAgICAgICAgICAgdGFnOiBmcmllbmQudG8udGFnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGxldCB0b2tlbiA9IGdlbmVyYXRlVG9rZW4odXNlci5faWQudG9TdHJpbmcoKSk7XHJcbiAgICBjb25maWcudG9rZW4gPSB0b2tlblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgICBtc2c6ICfnmbvpmYbmiJDlip8nLFxyXG4gICAgICAgIHRva2VuLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgX2lkOiB1c2VyLl9pZCxcclxuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXHJcbiAgICAgICAgICAgIGF2YXRhcjogdXRpbC5nZXRBdmF0YXJEYXRhKHVzZXIuYXZhdGFyKSxcclxuICAgICAgICAgICAgZ3JvdXBzOiBncm91cEFycixcclxuICAgICAgICAgICAgZnJpZW5kczogZnJpZW5kQXJyLFxyXG4gICAgICAgICAgICBpc0FkbWluOiB1c2VyLl9pZC50b1N0cmluZygpID09PSBjb25maWcuYWRtaW5pc3RyYXRvclxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIHRva2Vu55m75b2VXHJcbiAqIEBwYXJhbSB0b2tlblxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bXNnOiBzdHJpbmcsIHN0YXR1czogbnVtYmVyfXx7ZGF0YToge25hbWU6ICosIGdyb3VwczogKiwgYXZhdGFyOiAoc3RyaW5nfG51bWJlcnwqfHN0cmluZ3xTdHJpbmdDb25zdHJ1Y3RvcnxTdHJpbmcpLCBpc0FkbWluOiBib29sZWFuLCBmcmllbmRzOiAqfSwgc3RhdHVzOiBudW1iZXIsIHRva2VuOiAqfXx7bXNnOiBzdHJpbmcsIHN0YXR1czogbnVtYmVyfXx7bXNnOiBzdHJpbmcsIHN0YXR1czogbnVtYmVyfT59XHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBsb2dpbkJ5VG9rZW4odG9rZW4pIHtcclxuICAgIGxldCBwYXlsb2FkID0gbnVsbDtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcGF5bG9hZCA9IGp3dC5kZWNvZGUodG9rZW4sIGNvbmZpZy5qd3RTZWNyZXQpO1xyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICByZXR1cm4geyBtc2c6IFwi6Z2e5rOVdG9rZW5cIiwgc3RhdHVzOiA0MDF9O1xyXG4gICAgfVxyXG4gICAgaWYoRGF0ZS5ub3coKSA+IHBheWxvYWQuZXhwaXJlcykgcmV0dXJuIHsgbXNnOiBcInRva2Vu5aSx5pWI5LqG77yM6K+36YeN5paw55m76ZmGXCIsIHN0YXR1czogNDAxIH1cclxuICAgIGxldCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgX2lkOiBwYXlsb2FkLnVzZXIgfSk7XHJcbiAgICBpZighdXNlcikgcmV0dXJuIHsgbXNnOiAn5q2k55So5oi35LiN5a2Y5ZyoJywgc3RhdHVzOiA0MDEgfVxyXG4gICAgdXNlci5sYXN0TG9naW5UaW1lID0gRGF0ZS5ub3coKTtcclxuICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xyXG4gICAgbGV0IGdyb3VwQXJyID0gYXdhaXQgR3JvdXAuZmluZCh7IG1lbWJlcnM6IHVzZXIgfSwge1xyXG4gICAgICAgIF9pZDogMSxcclxuICAgICAgICBuYW1lOiAxLFxyXG4gICAgICAgIGF2YXRhcjogMSxcclxuICAgICAgICBjcmVhdG9yOiAxLFxyXG4gICAgICAgIGNyZWF0ZVRpbWU6IDFcclxuICAgIH0pO1xyXG4gICAgZ3JvdXBBcnIgPSBncm91cEFyci5tYXAoZ3JvdXAgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlZyA9IC9iYXNlNjQvZztcclxuICAgICAgICAhcmVnLnRlc3QoZ3JvdXAuYXZhdGFyKSAmJiAoZ3JvdXAuYXZhdGFyID0gdXRpbC5nZXRBdmF0YXJEYXRhKGdyb3VwLmF2YXRhcikpXHJcbiAgICAgICAgcmV0dXJuIGdyb3VwXHJcbiAgICB9KVxyXG4gICAgY29uc3QgcmVnID0gbmV3IFJlZ0V4cCh1c2VyLl9pZC50b1N0cmluZygpKVxyXG4gICAgbGV0IGZyaWVuZEFyciA9IGF3YWl0IEZyaWVuZC5maW5kKHsgcmVsYXRpb25JZDogeyRyZWdleDogcmVnfSwgc3RhdHVzOiAxIH0pLnBvcHVsYXRlKCd0byBmcm9tJywge1xyXG4gICAgICAgIF9pZDogMSxcclxuICAgICAgICBhdmF0YXI6IDEsXHJcbiAgICAgICAgdXNlcm5hbWU6IDEsXHJcbiAgICAgICAgdGFnOiAxXHJcbiAgICB9KVxyXG4gICAgZnJpZW5kQXJyID0gZnJpZW5kQXJyLm1hcChmcmllbmQgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlZyA9IC9iYXNlNjQvZztcclxuICAgICAgICAhcmVnLnRlc3QoZnJpZW5kLnRvLmF2YXRhcikgJiYgKGZyaWVuZC50by5hdmF0YXIgPSB1dGlsLmdldEF2YXRhckRhdGEoZnJpZW5kLnRvLmF2YXRhcikpXHJcbiAgICAgICAgIXJlZy50ZXN0KGZyaWVuZC5mcm9tLmF2YXRhcikgJiYgKGZyaWVuZC5mcm9tLmF2YXRhciA9IHV0aWwuZ2V0QXZhdGFyRGF0YShmcmllbmQuZnJvbS5hdmF0YXIpKVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIF9pZDogZnJpZW5kLl9pZCxcclxuICAgICAgICAgICAgY3JlYXRlVGltZTogZnJpZW5kLmNyZWF0ZVRpbWUsXHJcbiAgICAgICAgICAgIHN0YXR1czogZnJpZW5kLnN0YXR1cyxcclxuICAgICAgICAgICAgcmVsYXRpb25JZDogZnJpZW5kLnJlbGF0aW9uSWQsXHJcbiAgICAgICAgICAgIGZyb206IGZyaWVuZC5mcm9tLl9pZCxcclxuICAgICAgICAgICAgZnJvbVVzZXI6IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBmcmllbmQuZnJvbS51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIGF2YXRhcjogZnJpZW5kLmZyb20uYXZhdGFyLFxyXG4gICAgICAgICAgICAgICAgdGFnOiBmcmllbmQuZnJvbS50YWdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG86IHtcclxuICAgICAgICAgICAgICAgIF9pZDogZnJpZW5kLnRvLl9pZCxcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBmcmllbmQudG8udXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGZyaWVuZC50by5hdmF0YXIsXHJcbiAgICAgICAgICAgICAgICB0YWc6IGZyaWVuZC50by50YWdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHN0YXR1czogMjAwLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgX2lkOiB1c2VyLl9pZCxcclxuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXHJcbiAgICAgICAgICAgIGF2YXRhcjogIHV0aWwuZ2V0QXZhdGFyRGF0YSh1c2VyLmF2YXRhciksXHJcbiAgICAgICAgICAgIGdyb3VwczogZ3JvdXBBcnIsXHJcbiAgICAgICAgICAgIGZyaWVuZHM6IGZyaWVuZEFycixcclxuICAgICAgICAgICAgaXNBZG1pbjogdXNlci5faWQudG9TdHJpbmcoKSA9PT0gY29uZmlnLmFkbWluaXN0cmF0b3JcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG4vKipcclxuICog5qC55o2u55So5oi35ZCN5p+l5om+55So5oi3XHJcbiAqIEBwYXJhbSBkYXRhXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPCo+fVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoRnJpZW5kKGRhdGEpIHtcclxuICAgIGNvbnN0IHJlZyA9IG5ldyBSZWdFeHAoZGF0YS5rZXl3b3JkKVxyXG4gICAgbGV0IHVzZXJzID0gYXdhaXQgVXNlci5maW5kKHt1c2VybmFtZTogeyRyZWdleDogcmVnLCAkb3B0aW9uczogJ2knfX0pXHJcbiAgICB1c2VycyA9IHVzZXJzLm1hcCh1c2VyID0+IHtcclxuICAgICAgICByZXR1cm4gY29udmVydFVzZXJNc2codXNlcilcclxuICAgIH0pXHJcbiAgICByZXR1cm4gdXNlcnM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbnZlcnRVc2VyTXNnKHVzZXIpIHtcclxuICAgIGNvbnN0IHJlZyA9IC9iYXNlNjQvZztcclxuICAgICFyZWcudGVzdCh1c2VyLmF2YXRhcikgJiYgKHVzZXIuYXZhdGFyID0gdXRpbC5nZXRBdmF0YXJEYXRhKHVzZXIuYXZhdGFyKSlcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgX2lkOiB1c2VyLl9pZCxcclxuICAgICAgICB0YWc6IHVzZXIudGFnLFxyXG4gICAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxyXG4gICAgICAgIGF2YXRhcjogIHVzZXIuYXZhdGFyLFxyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHJlZ2lzdGVyLFxyXG4gICAgbG9naW5CeU5hbWVBbmRQYXNzLFxyXG4gICAgbG9naW5CeVRva2VuLFxyXG4gICAgc2VhcmNoRnJpZW5kXHJcbn1cclxuIl19
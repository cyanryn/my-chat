<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for chatserver/app.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\prettify.css" />
    <link rel="stylesheet" href="..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\index.html">All files</a> / <a href="index.html">chatserver</a> app.js
    </h1>
    <div class='clearfix'>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">require('./main')
const path = require("path");
const express = require('express')
const app = express();
const server = require('http').Server(app);
const io = require('socket.io')(server);
const session = require("express-session");
const bodyParser = require('body-parser')
&nbsp;
const config = require("./config");
const captcha = require("./router/captcha");
const user = require("./router/user");
const message = require("./router/message");
const upload = require("./router/upload");
&nbsp;
app.use(session({
    secret: 'keyboard cat',//使用随机自定义字符串进行加密
    resave: false,//即使 session 没有被修改，也保存 session 值，默认为 true
    saveUninitialized: true,//不保存未初始化的cookie，也就是未登录的cookie
    cookie: { secure: false }
}))
app.use(express.static(path.join(__dirname, 'public')))
app.use(bodyParser.json())//中间件只会解析 json ，允许请求提任意Unicode编码支持 gzip 和 deflate 编码
app.use(bodyParser.urlencoded({extended: false}))
app.use('/upload', upload)
app.use('/getImageCode', captcha);
app.use('/', user);
app.use('/m', message);
process.on('unhandledRejection', <span class="fstat-no" title="function not covered" >(r</span>eason, p) =&gt; {
<span class="cstat-no" title="statement not covered" >    console.log('Unhandled Rejection at: Promise', p, 'reason:', reason);</span>
});
&nbsp;
const apiList = require('./controller/apiList')
const onlineUsers = new Map()
io.on("connection", <span class="fstat-no" title="function not covered" >as</span>ync socket =&gt; {
    const defaultGroup = <span class="cstat-no" title="statement not covered" >await apiList.getDefaultGroup()</span>
&nbsp;
    //将连接到后端的用户socket和userId保存起来,并且发送好友通知
<span class="cstat-no" title="statement not covered" >    socket.on('init', <span class="fstat-no" title="function not covered" >as</span>ync ({socketId, userId}) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >        onlineUsers.set(userId.toString(), socket)</span>
        const friends = <span class="cstat-no" title="statement not covered" >await apiList.findFriendByTo(userId)</span>
<span class="cstat-no" title="statement not covered" >        friends.forEach(<span class="fstat-no" title="function not covered" >fr</span>iend =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            console.log(friend.to._id.toString(), userId.toString())</span>
<span class="cstat-no" title="statement not covered" >            friend.to._id.toString() === userId.toString() &amp;&amp; socket.join(friend.id, <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >                socket.emit('setFriendSystemMessage', friend)</span>
            })
        })
    })
&nbsp;
    // 用户点击列表进入聊天界面
<span class="cstat-no" title="statement not covered" >    socket.on('join', <span class="fstat-no" title="function not covered" >as</span>ync userInfo =&gt; {</span>
        const type = <span class="cstat-no" title="statement not covered" >userInfo.focus.type </span>// 1表示群组， 0表示好友
        const id = <span class="cstat-no" title="statement not covered" >userInfo.focus._id </span>  //id
        const linkmans = <span class="cstat-no" title="statement not covered" >userInfo.linkmans</span>
        let messages = <span class="cstat-no" title="statement not covered" >await apiList.getCurLastMessage(id, type)</span>
<span class="cstat-no" title="statement not covered" >        socket.join(id, <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
            let rooms = <span class="cstat-no" title="statement not covered" >Object.keys(socket.rooms)</span>
<span class="cstat-no" title="statement not covered" >            io.sockets.in(id).emit('joined', {id: id, messages: messages})/</span>/包括自己
            // socket.broadcast.to(defaultGroup._id).emit('joined', 'hh')//不包括自己
        })
<span class="cstat-no" title="statement not covered" >        linkmans.forEach(<span class="fstat-no" title="function not covered" >li</span>nkman =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            socket.join(linkman._id)</span>
        })
    })
<span class="cstat-no" title="statement not covered" >    socket.on('setFocus', <span class="fstat-no" title="function not covered" >as</span>ync userInfo =&gt; {</span>
        const type = <span class="cstat-no" title="statement not covered" >userInfo.focus.type </span>// 1表示群组， 0表示好友
        const id = <span class="cstat-no" title="statement not covered" >userInfo.focus._id </span>  //id
        let messages = <span class="cstat-no" title="statement not covered" >await apiList.getCurLastMessage(id, type)</span>
<span class="cstat-no" title="statement not covered" >        socket.join(id, <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            socket.emit('joined', {id: id, messages: messages})</span>
        })
    })
    //添加好友申请
<span class="cstat-no" title="statement not covered" >    socket.on('addFriend', <span class="fstat-no" title="function not covered" >as</span>ync data =&gt; {</span>
        const friendR = <span class="cstat-no" title="statement not covered" >await apiList.addFriend(data)</span>
<span class="cstat-no" title="statement not covered" >        if (friendR.status !== 400) {</span>
            const id = <span class="cstat-no" title="statement not covered" >data.id</span>
<span class="cstat-no" title="statement not covered" >            socket.join(id)</span>
            const other = <span class="cstat-no" title="statement not covered" >onlineUsers.get(data.to._id.toString())</span>
<span class="cstat-no" title="statement not covered" >            other &amp;&amp; other.join(id)</span>
<span class="cstat-no" title="statement not covered" >            data.status = friendR.status</span>
<span class="cstat-no" title="statement not covered" >            socket.broadcast.to(id).emit('setFriendSystemMessage', data)</span>
        }
<span class="cstat-no" title="statement not covered" >        socket.emit('addFriendAfter', friendR)</span>
    })
&nbsp;
    //对方同意加为好友
<span class="cstat-no" title="statement not covered" >    socket.on('agreeValidate', <span class="fstat-no" title="function not covered" >da</span>ta =&gt; {</span>
        const id = <span class="cstat-no" title="statement not covered" >data.id</span>
<span class="cstat-no" title="statement not covered" >        socket.join(id, <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            data.status = 1</span>
            const friend = <span class="cstat-no" title="statement not covered" >await apiList.updateFriend(data)</span>
            const linkman = <span class="cstat-no" title="statement not covered" >{</span>
                _id: id,
                name: data.from.username,
                avatar: data.from.avatar,
                createTime: friend.createTime,
                type: 0
            }
            const otherLinkman = <span class="cstat-no" title="statement not covered" >{</span>
                _id: id,
                name: data.to.username,
                avatar: data.to.avatar,
                createTime: friend.createTime,
                type: 0
            }
<span class="cstat-no" title="statement not covered" >            socket.emit('addLinkman', linkman)</span>
            const otherSocket = <span class="cstat-no" title="statement not covered" >onlineUsers.get(data.from._id.toString())</span>
<span class="cstat-no" title="statement not covered" >            otherSocket &amp;&amp; otherSocket.join(id, <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >                otherSocket.emit('addLinkman', otherLinkman)</span>
            })
        })
    })
&nbsp;
    //对方拒绝加为好友
<span class="cstat-no" title="statement not covered" >    socket.on('refuseValidate', <span class="fstat-no" title="function not covered" >da</span>ta =&gt; {</span>
        const id = <span class="cstat-no" title="statement not covered" >data.id</span>
<span class="cstat-no" title="statement not covered" >        socket.join(id, <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            data.status = 2</span>
            const friend = <span class="cstat-no" title="statement not covered" >await apiList.updateFriend(data)</span>
        })
    })
&nbsp;
&nbsp;
    // 发送消息
<span class="cstat-no" title="statement not covered" >    socket.on('message', <span class="fstat-no" title="function not covered" >as</span>ync data =&gt; {</span>
        const message = <span class="cstat-no" title="statement not covered" >await apiList.saveMessages(data)</span>
        // io.emit('message', data);
        // socket.broadcast.emit('message',data);
<span class="cstat-no" title="statement not covered" >        socket.emit('setFocusMessage', {message})</span>
<span class="cstat-no" title="statement not covered" >        socket.broadcast.to(message.to).emit('setFocusMessage', {message});</span>
    })
&nbsp;
    //创建群组
<span class="cstat-no" title="statement not covered" >    socket.on('createGroup', <span class="fstat-no" title="function not covered" >as</span>ync data =&gt; {</span>
        const group = <span class="cstat-no" title="statement not covered" >await apiList.createGroup(data)</span>
<span class="cstat-no" title="statement not covered" >        socket.join(group._id, <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            socket.emit('addLinkman', group)</span>
        })
    })
    //加入群组
<span class="cstat-no" title="statement not covered" >    socket.on('joinGroup', <span class="fstat-no" title="function not covered" >as</span>ync data =&gt; {</span>
        const result = <span class="cstat-no" title="statement not covered" >await apiList.joinGroup(data)</span>
<span class="cstat-no" title="statement not covered" >        console.log(data)</span>
<span class="cstat-no" title="statement not covered" >        socket.join(data.groupId, <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            socket.emit('addLinkman', result)</span>
<span class="cstat-no" title="statement not covered" >            socket.broadcast.to(data.groupId).emit('setFocusMessage', {message: result.message})</span>
        })
    })
    //解散群组
<span class="cstat-no" title="statement not covered" >    socket.on('delGroup', <span class="fstat-no" title="function not covered" >as</span>ync data =&gt; {</span>
        const result = <span class="cstat-no" title="statement not covered" >await apiList.delGroup(data)</span>
<span class="cstat-no" title="statement not covered" >        if (result.status) {</span>
<span class="cstat-no" title="statement not covered" >            socket.emit('delLinkman', result)</span>
        } else {
<span class="cstat-no" title="statement not covered" >            io.sockets.in(data).emit('delLinkman', result)</span>
        }
    })
&nbsp;
    //查找群组和用户
<span class="cstat-no" title="statement not covered" >    socket.on('searchLinkmans', <span class="fstat-no" title="function not covered" >as</span>ync data =&gt; {</span>
        const users = <span class="cstat-no" title="statement not covered" >await apiList.searchFriend(data)</span>
        const groups = <span class="cstat-no" title="statement not covered" >await apiList.searchGroup(data)</span>
<span class="cstat-no" title="statement not covered" >        socket.emit('searchResult', {users, groups})</span>
    })
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >    socket.on('getHistoryMessages', <span class="fstat-no" title="function not covered" >as</span>ync (focus) =&gt; {</span>
        // console.log(focus)
<span class="cstat-no" title="statement not covered" >        if (focus) {</span>
            const id = <span class="cstat-no" title="statement not covered" >focus._id</span>
            const messages = <span class="cstat-no" title="statement not covered" >await apiList.getHistoryMessage(id)</span>
<span class="cstat-no" title="statement not covered" >            socket.emit('getHistoryMessages', messages)</span>
        }
    })
&nbsp;
<span class="cstat-no" title="statement not covered" >    socket.on('searchExpression', <span class="fstat-no" title="function not covered" >as</span>ync keyword =&gt; {</span>
        const res = <span class="cstat-no" title="statement not covered" >await apiList.getExpression(keyword)</span>
<span class="cstat-no" title="statement not covered" >        socket.emit('getExpression', res)</span>
    })
&nbsp;
<span class="cstat-no" title="statement not covered" >    socket.on('getGroupMembers', <span class="fstat-no" title="function not covered" >as</span>ync name =&gt; {</span>
        const members = <span class="cstat-no" title="statement not covered" >await apiList.getGroupMembers(name)</span>
<span class="cstat-no" title="statement not covered" >        members &amp;&amp; socket.emit('setGroupMembers', members)</span>
    })
&nbsp;
<span class="cstat-no" title="statement not covered" >    socket.on('disconnect', <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >        console.log('disconnect')</span>
    })
})
server.listen(3000, <span class="fstat-no" title="function not covered" >()</span> =&gt; {
<span class="cstat-no" title="statement not covered" >    console.log('服务器在3000启动')</span>
});
&nbsp;
module.exports = {
    app,
    io,
    server
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Fri Apr 17 2020 21:38:10 GMT+0800 (GMT+08:00)
</div>
</div>
<script src="..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\sorter.js"></script>
</body>
</html>
